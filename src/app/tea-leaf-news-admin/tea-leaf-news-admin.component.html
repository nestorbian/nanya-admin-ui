<!-- loading -->
<!-- <ngx-loading [show]="loading" [config]="{ backdropBorderRadius: '14px'}"></ngx-loading> -->
<div class="content">
  <!-- 错误信息提示框 -->
  <div class="tip-postion" *ngIf="isShowErrorTip">
      <div class="alert alert-danger">
        <span class="glyphicon glyphicon-info-sign"></span>
        <div class="w10"></div>{{errorMessage}}
    </div>
  </div>

  <!-- 成功信息提示框 -->
  <div class="tip-postion" *ngIf="isShowSuccessTip">
      <div class="alert alert-success">
        <span class="glyphicon glyphicon-ok"></span>
        <div class="w10"></div>{{successMessage}}
    </div>
  </div>

  <!-- 遮罩层 -->
  <p-blockUI [blocked]="isShowBlock"></p-blockUI>

  <!-- 添加 -->
  <div class="panel panel-default add-module" *ngIf="isShowAddModule">
    <div class="panel-heading">
      <span>添加茶叶数据模块</span>
    </div>
    <form (ngSubmit)="addTeaLeafData()" #teaLeafDataForm="ngForm">
      <div class="panel-body">
        <div class="form-group">
          <label for="dataName">茶叶名称<span class="red">*</span>:</label>
          <input type="text" class="form-control" name="dataName" maxlength="30" [(ngModel)]="dataName" id="dataName"
          #localDataName="ngModel" required placeholder="限30个字" [class.red-border]="localDataName.touched && localDataName.invalid"/>
        </div>
        <div class="form-group">
          <label for="price">价格:</label>
          <div class="input-group">
            <input type="number" class="form-control" name="price" [(ngModel)]="price" #localPrice="ngModel" id="price" placeholder="限两位小数"
            required [class.red-border]="localPrice.touched && localPrice.invalid" (keypress)="removeChar($event)" (input)="removeInvalid($event)"
            aria-describedby="basic-addon2"/>
            <span class="input-group-addon" id="basic-addon2">元/斤</span>
          </div>
        </div>
        <div class="form-group">
          <label for="address">销售地址<span class="red">*</span>:</label>
          <input type="text" class="form-control" name="address" maxlength="100" [(ngModel)]="address" id="address"
          #localAddress="ngModel" required placeholder="限100个字" [class.red-border]="localAddress.touched && localAddress.invalid"/>
        </div>
        <div class="form-group">
          <label for="phone">联系方式<span class="red">*</span>:</label>
          <input type="tel" class="form-control" name="phone" maxlength="11" [(ngModel)]="phone" id="phone" #localPhone="ngModel" 
          required placeholder="建议使用常用手机" [class.red-border]="localPhone.touched && localPhone.invalid"
          onkeyup="this.value=this.value.replace(/[^\d]/g,'')"/>
        </div>
        <div class="form-group">
          <label for="surveyTime">调查日期<span class="red">*</span>:</label>
          <p-calendar [(ngModel)]="surveyTime" id="surveyTime" name="surveyTime" #localSurveyTime="ngModel" required [locale]="en"
           dateFormat="yy-mm-dd" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2036" [maxDate]="maxDate">
          </p-calendar>
        </div>
      </div>
      <div class="panel-footer clearfix">
        <button class="btn btn-default fr" type="button" (click)="cancelAddModule()">取消</button>
        <button class="btn btn-info fr mr10" type="submit" [disabled]="!teaLeafDataForm.form.valid">保存</button>
      </div>
    </form>
  </div>

  <!-- 修改 -->
  <div class="panel panel-default modify-module" *ngIf="isShowModifyModule">
    <div class="panel-heading">
      <span>修改茶叶数据模块</span>
    </div>
    <form #modifyTeaLeafData="ngForm" (ngSubmit)="modifyTeaLeafDataById()">
      <div class="panel-body">
        <div class="form-group">
          <label for="dataName">茶叶名称<span class="red">*</span>:</label>
          <input type="text" class="form-control" name="dataName" maxlength="30" [(ngModel)]="dataName" id="dataName"
          #localDataName="ngModel" required placeholder="限30个字" [class.red-border]="localDataName.touched && localDataName.invalid"/>
        </div>
        <div class="form-group">
          <label for="price">价格:</label>
          <div class="input-group">
            <input type="number" class="form-control" name="price" [(ngModel)]="price" #localPrice="ngModel" id="price" placeholder="限两位小数"
            required [class.red-border]="localPrice.touched && localPrice.invalid" (keypress)="removeChar($event)" (input)="removeInvalid($event)"
            aria-describedby="basic-addon2"/>
            <span class="input-group-addon" id="basic-addon2">元/斤</span>
          </div>
        </div>
        <div class="form-group">
          <label for="address">销售地址<span class="red">*</span>:</label>
          <input type="text" class="form-control" name="address" maxlength="100" [(ngModel)]="address" id="address"
          #localAddress="ngModel" required placeholder="限100个字" [class.red-border]="localAddress.touched && localAddress.invalid"/>
        </div>
        <div class="form-group">
          <label for="phone">联系方式<span class="red">*</span>:</label>
          <input type="tel" class="form-control" name="phone" maxlength="11" [(ngModel)]="phone" id="phone" #localPhone="ngModel" 
          required placeholder="建议使用常用手机" [class.red-border]="localPhone.touched && localPhone.invalid"
          onkeyup="this.value=this.value.replace(/[^\d]/g,'')"/>
        </div>
        <div class="form-group">
          <label for="surveyTime">调查日期<span class="red">*</span>:</label>
          <p-calendar [(ngModel)]="surveyTime" id="surveyTime" name="surveyTime" #localSurveyTime="ngModel" required [locale]="en"
           dateFormat="yy-mm-dd" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2036" [maxDate]="maxDate">
          </p-calendar>
        </div>
      </div>
      <div class="panel-footer clearfix">
        <button class="btn btn-default fr" type="button" (click)="cancelModifyModule()">取消</button>
        <button class="btn btn-info fr mr10" type="submit" [disabled]="!modifyTeaLeafData.form.valid">保存</button>
      </div>
    </form>
  </div>

  <!-- 删除模块 -->
  <div class="panel panel-danger delete-module" *ngIf="isShowDeleteModule">
    <div class="panel-heading">确定要删除该茶叶数据吗？</div>
    <div class="panel-body">
      <button class="btn btn-info" (click)="confirmDeleteTeaLeafData()">确定</button>
      <div class="w10"></div>
      <button class="btn btn-default" (click)="cancelDeleteModule()">取消</button>
    </div>
  </div>

  <!-- 茶叶资讯管理 -->
  <div class="head clearfix">
    <span class="head-title">茶叶资讯管理</span>
    <button class="btn btn-info fr" (click)="isShowAddModule=true;isShowBlock=true"><span class="fa fa-plus"></span>&nbsp;添加</button>
  </div>
  <hr />
  <!-- 市场调研表 -->
  <h3 class="text-center">市场调研表</h3>
  <table class="table table-bordered table-hover table-striped">
    <thead>
      <tr>
        <th width="5%">序号</th>
        <th width="15%">茶叶名称</th>
        <th width="10%">价格</th>
        <th width="40%">地址</th>
        <th width="10%">联系方式</th>
        <th width="10%">调查时间</th>
        <th width="10%">操作</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let teaLeafData of teaLeafDataList;let i = index">
        <td>{{(pageNum - 1) * pageSize + i + 1}}</td>
        <td>{{teaLeafData.dataName}}</td>
        <td>{{teaLeafData.price}}元/斤</td>
        <td>{{teaLeafData.address}}</td>
        <td>{{teaLeafData.phone}}</td>
        <td>{{teaLeafData.surveyTime|date:'yyyy-MM-dd'}}</td>
        <td>
          <button class="btn btn-warning" (click)="showModifyModule(teaLeafData.dataId)">
            <span class="glyphicon glyphicon-edit"></span>
          </button>
          <button class="btn btn-danger" (click)="deleteTeaLeafData(teaLeafData.dataId)">
            <span class="glyphicon glyphicon-trash"></span>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
  <nav aria-label="Page navigation" class="clearfix" style="padding-right:30px;">
    <p-button class="pull-right" (onClick)="goPage()" label="GO" style="margin: 5px;"></p-button>
    <input type="text" class="form-control pull-right pagination-input" name="pageForSkip" [(ngModel)]="pageForSkip" (keypress)="removeChar($event)"/>
    <span class="pull-right pagination-span">共{{total}}条/共{{pages}}页</span>
    <ul class="pagination pull-right">
      <li [class.disabled]="pageNum === 1">
        <a (click)="prePage()" aria-label="Previous" class="cp">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <li *ngIf="pageNum === pages - 1 && pageNum - 3 > 0"><a (click)="skipPage(pageNum - 3)" class="cp">{{pageNum - 3}}</a></li>
      <li *ngIf="pageNum === pages && pageNum - 4 > 0"><a (click)="skipPage(pageNum - 4)" class="cp">{{pageNum - 4}}</a></li>
      <li *ngIf="pageNum === pages && pageNum - 3 > 0"><a (click)="skipPage(pageNum - 3)" class="cp">{{pageNum - 3}}</a></li>
      <li *ngIf="pageNum - 2 > 0"><a (click)="skipPage(pageNum - 2)" class="cp">{{pageNum - 2}}</a></li>
      <li *ngIf="pageNum - 1 > 0"><a (click)="skipPage(pageNum - 1)" class="cp">{{pageNum - 1}}</a></li>
      <li class="active"><a (click)="skipPage(pageNum)" class="cp">{{pageNum}}</a></li>
      <li *ngIf="pageNum + 1 <= pages"><a (click)="skipPage(pageNum + 1)" class="cp">{{pageNum + 1}}</a></li>
      <li *ngIf="pageNum + 2 <= pages"><a (click)="skipPage(pageNum + 2)" class="cp">{{pageNum + 2}}</a></li>
      <li *ngIf="pageNum === 1 && pageNum + 3 <= pages"><a (click)="skipPage(pageNum + 3)" class="cp">{{pageNum + 3}}</a></li>
      <li *ngIf="pageNum === 1 && pageNum + 4 <= pages"><a (click)="skipPage(pageNum + 4)" class="cp">{{pageNum + 4}}</a></li>
      <li *ngIf="pageNum === 2 && pageNum + 3 <= pages"><a (click)="skipPage(pageNum + 3)" class="cp">{{pageNum + 3}}</a></li>
      <li [class.disabled]="pageNum === pages">
        <a (click)="nextPage()" aria-label="Next" class="cp">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
  <div class="generate-div">
    <label>选择日期范围：</label>
    <p-calendar [(ngModel)]="rangeDates" [monthNavigator]="true" [yearNavigator]="true" yearRange="2000:2036" selectionMode="range" 
    readonlyInput="true" [locale]="en" dateFormat="yy-mm-dd" [maxDate]="maxDate">
    </p-calendar>
    <button pButton type="button" (click)="generateTeaLeafNews()" label="生成茶叶资讯表"></button>
  </div>
  <!-- 茶叶资讯表格 -->
  <h3 class="text-center">茶叶资讯表</h3>
  <table class="table table-bordered table-hover table-striped">
    <thead>
      <tr>
        <th width="10%">序号</th>
        <th width="20%">茶叶名称</th>
        <th width="20%">价格</th>
        <th width="20%">热度（数值越大，热度越高）</th>
        <th width="15%">起始时间</th>
        <th width="15%">结束时间</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let teaLeafNews of teaLeafNewsList;let i = index">
        <td>{{(pageNumForNews - 1) * pageSizeForNews + i + 1}}</td>
        <td>{{teaLeafNews.teaLeafName}}</td>
        <td>{{teaLeafNews.price}}元/斤</td>
        <td>{{teaLeafNews.weight}}</td>
        <td>{{teaLeafNews.startTime|date:'yyyy-MM-dd'}}</td>
        <td>{{teaLeafNews.endTime|date:'yyyy-MM-dd'}}</td>
      </tr>
    </tbody>
  </table>
  <nav aria-label="Page navigation" class="clearfix" style="padding-right:30px;">
    <p-button class="pull-right" (onClick)="goPageForNews()" label="GO" style="margin: 5px;"></p-button>
    <input type="text" class="form-control pull-right pagination-input" name="pageForSkipForNews" [(ngModel)]="pageForSkipForNews" (keypress)="removeChar($event)"/>
    <span class="pull-right pagination-span">共{{totalForNews}}条/共{{pagesForNews}}页</span>
    <ul class="pagination pull-right">
      <li [class.disabled]="pageNumForNews === 1">
        <a (click)="prePageForNews()" aria-label="Previous" class="cp">
          <span aria-hidden="true">&laquo;</span>
        </a>
      </li>
      <li *ngIf="pageNumForNews === pagesForNews - 1 && pageNumForNews - 3 > 0"><a (click)="skipPageForNews(pageNumForNews - 3)" class="cp">{{pageNumForNews - 3}}</a></li>
      <li *ngIf="pageNumForNews === pagesForNews && pageNumForNews - 4 > 0"><a (click)="skipPageForNews(pageNumForNews - 4)" class="cp">{{pageNumForNews - 4}}</a></li>
      <li *ngIf="pageNumForNews === pagesForNews && pageNumForNews - 3 > 0"><a (click)="skipPageForNews(pageNumForNews - 3)" class="cp">{{pageNumForNews - 3}}</a></li>
      <li *ngIf="pageNumForNews - 2 > 0"><a (click)="skipPageForNews(pageNumForNews - 2)" class="cp">{{pageNumForNews - 2}}</a></li>
      <li *ngIf="pageNumForNews - 1 > 0"><a (click)="skipPageForNews(pageNumForNews - 1)" class="cp">{{pageNumForNews - 1}}</a></li>
      <li class="active"><a (click)="skipPageForNews(pageNumForNews)" class="cp">{{pageNumForNews}}</a></li>
      <li *ngIf="pageNumForNews + 1 <= pagesForNews"><a (click)="skipPageForNews(pageNumForNews + 1)" class="cp">{{pageNumForNews + 1}}</a></li>
      <li *ngIf="pageNumForNews + 2 <= pagesForNews"><a (click)="skipPageForNews(pageNumForNews + 2)" class="cp">{{pageNumForNews + 2}}</a></li>
      <li *ngIf="pageNumForNews === 1 && pageNumForNews + 3 <= pagesForNews"><a (click)="skipPageForNews(pageNumForNews + 3)" class="cp">{{pageNumForNews + 3}}</a></li>
      <li *ngIf="pageNumForNews === 1 && pageNumForNews + 4 <= pagesForNews"><a (click)="skipPageForNews(pageNumForNews + 4)" class="cp">{{pageNumForNews + 4}}</a></li>
      <li *ngIf="pageNumForNews === 2 && pageNumForNews + 3 <= pagesForNews"><a (click)="skipPageForNews(pageNumForNews + 3)" class="cp">{{pageNumForNews + 3}}</a></li>
      <li [class.disabled]="pageNumForNews === pagesForNews">
        <a (click)="nextPageForNews()" aria-label="Next" class="cp">
          <span aria-hidden="true">&raquo;</span>
        </a>
      </li>
    </ul>
  </nav>
</div>

